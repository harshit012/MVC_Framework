<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<title>mvc_example</title>

<script>
var tmmvc={};
tmmvc.model=null;
var textField={};
var checkBox={};
var radioButton={};
var singleAttributeComboBox={};
var multipleAttributeComboBox={};
var fieldReference=[];
var fieldData=[];
var tmmvc_ifComponents=[];
var tmmvc_buttons=[];
var replaceString="";

function updateInnerHTML()
{
for(let e=0;e<fieldData.length;e++)
{
fieldReference[e].innerHTML=eval(fieldData[e]);
}
}

function updateUI()
{
for(let e=0;e<tmmvc_ifComponents.length;e++)
{
condition=tmmvc_ifComponents[e].getAttribute("tmmvc_if");
if(eval("tmmvc.model."+condition))
{
tmmvc_ifComponents[e].style.display="block";
}
else
{
tmmvc_ifComponents[e].style.display="none";
}
}
updateInnerHTML()
}


function getInnerHTML(data)
{
let e=0;
let si=0;
let ei=0;
let key="";
let count=0;
let finalString="";
while(data.indexOf("{{{",e)>=0)
{
e=data.indexOf("{{{",e)+1;
if(finalString.length==0 && count!=e) finalString+="\""+data.substring(count,e-1)+"\"";
else finalString+="+\""+data.substring(count,e-1)+"\"";
count=e-1;
si=e;
e=e+1;
ei=data.indexOf("}}}",e)+1;
if(ei==-1)
{
break;
}
else
{
key=data.substring(si+2,ei-1);
if(finalString.length==0) finalString+="eval(tmmvc.model."+key+")";
else finalString+="+eval(tmmvc.model."+key+")";
count=ei+2;
}
}
if(count<=data.length) finalString+="+\""+data.substring(count)+"\"";
return finalString;
}

function storeInitialData()
{
headings=document.getElementsByTagName('h1');
let flag=false;
for(let e=0;e<headings.length;e++)
{
let data=headings[e].innerHTML;
if(data.search("{{{")!=-1 && data.search("}}}")!=-1)
{
fieldReference[fieldReference.length]=headings[e];
fieldData[fieldData.length]=getInnerHTML(data);
}
}

paragraphs=document.getElementsByTagName('p');
flag=false;
for(let e=0;e<paragraphs.length;e++)
{
let data=paragraphs[e].innerHTML;
if(data.search("{{{")!=-1 && data.search("}}}")!=-1)
{
fieldReference[fieldReference.length]=paragraphs[e];
fieldData[fieldData.length]=getInnerHTML(data);
}
}


divisions=document.getElementsByTagName('div');
flag=false;
for(let e=0;e<divisions.length;e++)
{
let data=divisions[e].innerHTML;
if(data.search("{{{")!=-1 && data.search("}}}")!=-1)
{
fieldReference[fieldReference.length]=divisions[e];
fieldData[fieldData.length]=getInnerHTML(data);
}
}

spans=document.getElementsByTagName('span');
flag=false;
for(let e=0;e<spans.length;e++)
{
let data=spans[e].innerHTML;
if(data.search("{{{")!=-1 && data.search("}}}")!=-1)
{
fieldReference[fieldReference.length]=spans[e];
fieldData[fieldData.length]=getInnerHTML(data);
}
}
}



function initializeUI()
{
let allTags=document.getElementsByTagName("*");
let x;
let t=null;
let a=null;
x=0;
while(x<allTags.length)
{
t=allTags[x];
if(t.hasAttribute("tmmvc_if"))
{
tmmvc_ifComponents[tmmvc_ifComponents.length]=t;
}
if(t.type=="button" && t.hasAttribute("tmmvc_click"))
{
tmmvc_buttons[tmmvc_buttons.length]=t;
}
x++;
}
}

function setOnClickToButtons()
{
for(let e=0;e<tmmvc_buttons.length;e++)
{
tmmvc_buttons[e].onclick=function(){
functionName=this.getAttribute("tmmvc_click");
eval("tmmvc.controller."+functionName+"()");
};//function defination ends here;
}
}


function initializeComponents()
{
storeInitialData();
initializeUI();
setOnClickToButtons();
inputs=document.getElementsByTagName('input');
for(let e=0;e<inputs.length;e++)
{
if(inputs[e].hasAttribute("tmmvc_attribute"))
{
type=inputs[e].getAttribute("type");
if(type=="text" || type=="number" || type=="password")
{
keyName=inputs[e].getAttribute("tmmvc_attribute");
eval("textField."+keyName+"=inputs[e]");
inputs[e].oninput=function(){
let bindTo="value";
if(this.hasAttribute("tmmvc_bind_to")) bindTo=this.getAttribute("tmmvc_bind_to");
tmmvc.model[this.getAttribute("tmmvc_attribute")]=eval("this."+bindTo);
};//function definition ends here
}//if ends here
if(type=="checkbox")
{
keyName=inputs[e].getAttribute("tmmvc_attribute");
eval("checkBox."+keyName+"=inputs[e]");
inputs[e].oninput=function(){
let bindTo="checked";
if(this.hasAttribute("tmmvc_bind_to")) bindTo=this.getAttribute("tmmvc_bind_to");
tmmvc.model[this.getAttribute("tmmvc_attribute")]=eval("this."+bindTo);
};//function definition ends here
}//if ends here
if(type=="radio")
{
if(inputs[e].getAttribute("tmmvc_attribute") in radioButton)
{
lt=radioButton[inputs[e].name];
lt[lt.length]=inputs[e];
}else
{
lt=[];
lt[0]=inputs[e];
eval("radioButton."+inputs[e].getAttribute("tmmvc_attribute")+"=lt");
}
inputs[e].oninput=function(){
let bindTo="value";
if(this.hasAttribute("tmmvc_bind_to")) bindTo=this.getAttribute("tmmvc_bind_to");
if(this.checked)
{
tmmvc.model[this.getAttribute("tmmvc_attribute")]=eval("this."+bindTo);
}
};//function definition ends here
}//if ends here
}//if ends here
}//loop ends here

selects=document.getElementsByTagName('select');
for(let e=0;e<selects.length;e++)
{
if(selects[e].hasAttribute("tmmvc_attribute"))
{
if(selects[e].hasAttribute("multiple"))
{
keyName=selects[e].getAttribute("tmmvc_attribute");
eval("multipleAttributeComboBox."+keyName+"=selects[e]");
selects[e].onchange=function(){
selectedOptions=this.selectedOptions;
lt=[]
for(j=0;j<selectedOptions.length;j++) lt[j]=selectedOptions[j].value;
tmmvc.model[this.getAttribute("tmmvc_attribute")]=lt;
};
}else
{
keyName=selects[e].getAttribute("tmmvc_attribute");
eval("singleAttributeComboBox."+keyName+"=selects[e]");
selects[e].onchange=function(){
let bindTo="selectedIndex";
if(this.hasAttribute("tmmvc_bind_to")) bindTo=this.getAttribute("tmmvc_bind_to");
tmmvc.model[this.getAttribute("tmmvc_attribute")]=eval("this."+bindTo);
};//function definition ends here
}
}//if has Attribute ends here
}// for loop ends here
setInterval(updateComponents,100);
}//function definition ends here




function updateComponents()
{
for(let key in tmmvc.model)
{ 
if(key in textField)
{
textField[key].value=tmmvc.model[key];
}else if(key in checkBox)
{
checkBox[key].checked=tmmvc.model[key];
}else if(key in radioButton)
{
lt=radioButton[key];
val=tmmvc.model[key];
let f;
for(f=0;f<lt.length;f++)
{
if(val==lt[f].value)
{
lt[f].checked=true;
break;
}
}
if(f==lt.length)
{
for(f=0;f<lt.length;f++) lt[f].checked=false;
}
}
else if(key in singleAttributeComboBox)
{
singleAttributeComboBox[key].selectedIndex=tmmvc.model[key];
}else if(key in multipleAttributeComboBox)
{
lt=tmmvc.model[key];
for(e=0;e<lt;e++) multipleAttributeComboBox.selectedIndex=lt[e];
}
else continue;
}
updateUI();
}

setTimeout(initializeComponents,100);
</script>
<script>
var ds={
"mode":'A',
"formNumber": 0,
"name": "",
"gender":"",
"city":-1,
"isHandicaped":false
};

function frmsbt(frm)
{
//alert(ds.name);
//alert(ds.gender);
//alert(ds.isHandicaped);
//alert(ds.city);
ds.formNumber=ds.name.length;
ds.name="";
ds.gender="";
ds.isHandicaped=false;
ds.city=-1;
return false;
}

function justDoIt()
{
alert("function invoked");
alert(document.getElementsByTagName('body')[0].innerHTML);
}


class Student
{
constructor()
{
this.ds={
"mode":'A',
"formNumber": 0,
"name": "",
"gender":"",
"city":-1,
"isHandicaped":false
};
}
add()
{
alert("Name:"+this.ds.name+" , Gender:"+this.ds.gender+" , City:"+this.ds.city+" , is Handicaped:"+this.ds.isHandicaped);
this.ds.mode='U';
}
update()
{
alert("Name:"+this.ds.name+" , Gender:"+this.ds.gender+" , City:"+this.ds.city+" , is Handicaped:"+this.ds.isHandicaped);
this.ds.mode='D';
}
delete()
{
alert("Name:"+this.ds.name+" , Gender:"+this.ds.gender+" , City:"+this.ds.city+" , is Handicaped:"+this.ds.isHandicaped);
this.ds.mode='A';
}
}

window.addEventListener('load',function(){
var c=new Student;
tmmvc.controller=c;
tmmvc.model=c.ds;
});
</script>
</head>
<body>
<center>


<div tmmvc_if="mode=='A'" >
<h1>Add Student Form</h1>
<br>
<form action='#' onsubmit='return frmsbt(this)'>
Name&nbsp;
<input type='text' id='name' name='name' tmmvc_attribute='name' tmmvc_bind_to='value'>
<br><br>
Gender&nbsp;
<input type='radio' id='male' name='gender' value='M' tmmvc_attribute='gender' tmmvc_bind_to='value'>Male
&nbsp;&nbsp;&nbsp;&nbsp;
<input type='radio' id='female' name='gender' value='F' tmmvc_attribute='gender' tmmvc_bind_to='value'>Female
&nbsp;&nbsp;&nbsp;&nbsp;
<input type='radio' id='transgender' name='gender' value='T' tmmvc_attribute='gender' tmmvc_bind_to='value'>Transgender
<br><br>
City&nbsp;
<td><select id='city' name='city' tmmvc_attribute='city' tmmvc_bind_to='selectedIndex'>
<option value='-1'>Select City</option>
<option value='1'>Ujjain</option>
<option value='2'>Dewas</option>
<option value='3'>Indore</option>
<option value='4'>Bhopal</option>
<option value='5'>Jaipur</option>
</select>
<br><br>
Handicaped &nbsp;</td>
<input type='checkbox' name='isHandicaped' id='isHandicaped' tmmvc_attribute='isHandicaped' tmmvc_bind_to='checked'>
<br><br><br>
<button type='button' tmmvc_click='add'>Add Student</button>
</form>
</div>

<div tmmvc_if="mode=='U'" >
<h1>Update Student Form</h1>
<br>
<form action='#' onsubmit='return frmsbt(this)'>
Name&nbsp;
<input type='text' id='name' name='name' tmmvc_attribute='name' tmmvc_bind_to='value'>
<br><br>
Gender&nbsp;
<input type='radio' id='male' name='gender' value='M' tmmvc_attribute='gender' tmmvc_bind_to='value'>Male
&nbsp;&nbsp;&nbsp;&nbsp;
<input type='radio' id='female' name='gender' value='F' tmmvc_attribute='gender' tmmvc_bind_to='value'>Female
&nbsp;&nbsp;&nbsp;&nbsp;
<input type='radio' id='transgender' name='gender' value='T' tmmvc_attribute='gender' tmmvc_bind_to='value'>Transgender
<br><br>
City&nbsp;
<td><select id='city' name='city' tmmvc_attribute='city' tmmvc_bind_to='selectedIndex'>
<option value='-1'>Select City</option>
<option value='1'>Ujjain</option>
<option value='2'>Dewas</option>
<option value='3'>Indore</option>
<option value='4'>Bhopal</option>
<option value='5'>Jaipur</option>
</select>
<br><br>
Handicaped &nbsp;</td>
<input type='checkbox' name='isHandicaped' id='isHandicaped' tmmvc_attribute='isHandicaped' tmmvc_bind_to='checked'>
<br><br><br>
<button type='button' tmmvc_click='update'>Update Student</button>
</form>
</div>


<div tmmvc_if="mode=='D'" >
<h1>Delete Student Form</h1>
<br>
<form action='#'>
Name&nbsp;
<input type='text' id='name' name='name' tmmvc_attribute='name' tmmvc_bind_to='value'>
<br><br><br>
<button type='button' tmmvc_click='delete'>Delete Student</button>
</form>
</div>




</center>
</body>
</html>
